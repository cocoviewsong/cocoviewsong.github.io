import{u as z}from"./use-expose-iB1OiNuX.js";import{k as D,d as J,r as f,D as W,f as j,J as q,at as F,H as G,h as A,B as K,m as x,x as O}from"./index-D_ZZm4wJ.js";import{w as Q}from"./dom-CMRIcg9Q.js";const[U,b]=D("text-ellipsis"),X={rows:K(1),dots:x("..."),content:x(""),expandText:x(""),collapseText:x(""),position:x("end")};var Y=J({name:U,props:X,emits:["clickAction"],setup(n,{emit:L,slots:v}){const h=f(n.content),u=f(!1),H=f(!1),T=f(),C=f();let M=!1;const S=W(()=>u.value?n.collapseText:n.expandText),w=e=>{if(!e)return 0;const t=e.match(/^\d*(\.\d*)?/);return t?Number(t[0]):0},_=()=>{if(!T.value||!T.value.isConnected)return;const e=window.getComputedStyle(T.value),t=document.createElement("div");return Array.prototype.slice.apply(e).forEach(a=>{t.style.setProperty(a,e.getPropertyValue(a))}),t.style.position="fixed",t.style.zIndex="-9999",t.style.top="-9999px",t.style.height="auto",t.style.minHeight="auto",t.style.maxHeight="auto",t.innerText=n.content,document.body.appendChild(t),t},B=(e,t)=>{var r,a;const{content:s,position:p,dots:m}=n,d=s.length,N=0+d>>1,g=v.action?(a=(r=C.value)==null?void 0:r.outerHTML)!=null?a:"":n.expandText,V=()=>{const o=(i,l)=>{if(l-i<=1)return p==="end"?s.slice(0,i)+m:m+s.slice(l,d);const c=Math.round((i+l)/2);return p==="end"?e.innerText=s.slice(0,c)+m:e.innerText=m+s.slice(c,d),e.innerHTML+=g,e.offsetHeight>t?p==="end"?o(i,c):o(c,l):p==="end"?o(c,l):o(i,c)};return o(0,d)},k=(o,i)=>{if(o[1]-o[0]<=1&&i[1]-i[0]<=1)return s.slice(0,o[0])+m+s.slice(i[1],d);const l=Math.floor((o[0]+o[1])/2),c=Math.ceil((i[0]+i[1])/2);return e.innerText=n.content.slice(0,l)+n.dots+n.content.slice(c,d),e.innerHTML+=g,e.offsetHeight>=t?k([o[0],l],[c,i[1]]):k([l,o[1]],[i[0],c])};return n.position==="middle"?k([0,N],[N,d]):V()},y=()=>{const e=_();if(!e){M=!0;return}const{paddingBottom:t,paddingTop:r,lineHeight:a}=e.style,s=Math.ceil((Number(n.rows)+.5)*w(a)+w(r)+w(t));s<e.offsetHeight?(H.value=!0,h.value=B(e,s)):(H.value=!1,h.value=n.content),document.body.removeChild(e)},E=(e=!u.value)=>{u.value=e},I=e=>{E(),L("clickAction",e)},R=()=>{const e=v.action?v.action({expanded:u.value}):S.value;return A("span",{ref:C,class:b("action"),onClick:I},[e])};return j(()=>{y(),v.action&&q(y)}),F(()=>{M&&(M=!1,y())}),G([Q,()=>[n.content,n.rows,n.position]],y),z({toggle:E}),()=>A("div",{ref:T,class:b()},[u.value?n.content:h.value,H.value?R():null])}});const ee=O(Y);export{ee as T};
