import{u as B}from"./use-expose-okgu5C5J.js";import{l as J,d as K,r as f,E as W,f as j,K as q,at as D,J as F,i as A,C as G,m as x,y as O}from"./index-B3aFaRz9.js";import{w as Q}from"./dom-CgZUjhBj.js";const[U,b]=J("text-ellipsis"),X={rows:G(1),dots:x("..."),content:x(""),expandText:x(""),collapseText:x(""),position:x("end")};var Y=K({name:U,props:X,emits:["clickAction"],setup(n,{emit:L,slots:v}){const h=f(n.content),u=f(!1),M=f(!1),T=f(),E=f();let w=!1;const S=W(()=>u.value?n.collapseText:n.expandText),H=e=>{if(!e)return 0;const t=e.match(/^\d*(\.\d*)?/);return t?Number(t[0]):0},_=()=>{if(!T.value||!T.value.isConnected)return;const e=window.getComputedStyle(T.value),t=document.createElement("div");return Array.prototype.slice.apply(e).forEach(a=>{t.style.setProperty(a,e.getPropertyValue(a))}),t.style.position="fixed",t.style.zIndex="-9999",t.style.top="-9999px",t.style.height="auto",t.style.minHeight="auto",t.style.maxHeight="auto",t.innerText=n.content,document.body.appendChild(t),t},I=(e,t)=>{var r,a;const{content:s,position:p,dots:m}=n,d=s.length,g=0+d>>1,k=v.action?(a=(r=E.value)==null?void 0:r.outerHTML)!=null?a:"":n.expandText,z=()=>{const o=(i,l)=>{if(l-i<=1)return p==="end"?s.slice(0,i)+m:m+s.slice(l,d);const c=Math.round((i+l)/2);return p==="end"?e.innerText=s.slice(0,c)+m:e.innerText=m+s.slice(c,d),e.innerHTML+=k,e.offsetHeight>t?p==="end"?o(i,c):o(c,l):p==="end"?o(c,l):o(i,c)};return o(0,d)},C=(o,i)=>{if(o[1]-o[0]<=1&&i[1]-i[0]<=1)return s.slice(0,o[0])+m+s.slice(i[1],d);const l=Math.floor((o[0]+o[1])/2),c=Math.ceil((i[0]+i[1])/2);return e.innerText=n.content.slice(0,l)+n.dots+n.content.slice(c,d),e.innerHTML+=k,e.offsetHeight>=t?C([o[0],l],[c,i[1]]):C([l,o[1]],[i[0],c])};return n.position==="middle"?C([0,g],[g,d]):z()},y=()=>{const e=_();if(!e){w=!0;return}const{paddingBottom:t,paddingTop:r,lineHeight:a}=e.style,s=Math.ceil((Number(n.rows)+.5)*H(a)+H(r)+H(t));s<e.offsetHeight?(M.value=!0,h.value=I(e,s)):(M.value=!1,h.value=n.content),document.body.removeChild(e)},N=(e=!u.value)=>{u.value=e},R=e=>{N(),L("clickAction",e)},V=()=>{const e=v.action?v.action({expanded:u.value}):S.value;return A("span",{ref:E,class:b("action"),onClick:R},[e])};return j(()=>{y(),v.action&&q(y)}),D(()=>{w&&(w=!1,y())}),F([Q,()=>[n.content,n.rows,n.position]],y),B({toggle:N}),()=>A("div",{ref:T,class:b()},[u.value?n.content:h.value,M.value?V():null])}});const ee=O(Y);export{ee as T};
