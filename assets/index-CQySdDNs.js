import{u as B}from"./use-expose-D4DLcQFk.js";import{h as D,d as W,z as f,c as j,E as q,D as F,at as G,C as J,f as A,x as K,m as x,p as O}from"./index-D5DcdRcn.js";import{w as Q}from"./dom-BMB3Oe96.js";const[U,b]=D("text-ellipsis"),X={rows:K(1),dots:x("..."),content:x(""),expandText:x(""),collapseText:x(""),position:x("end")};var Y=W({name:U,props:X,emits:["clickAction"],setup(n,{emit:L,slots:v}){const h=f(n.content),u=f(!1),M=f(!1),T=f(),E=f();let w=!1;const S=j(()=>u.value?n.collapseText:n.expandText),H=e=>{if(!e)return 0;const t=e.match(/^\d*(\.\d*)?/);return t?Number(t[0]):0},_=()=>{if(!T.value||!T.value.isConnected)return;const e=window.getComputedStyle(T.value),t=document.createElement("div");return Array.prototype.slice.apply(e).forEach(a=>{t.style.setProperty(a,e.getPropertyValue(a))}),t.style.position="fixed",t.style.zIndex="-9999",t.style.top="-9999px",t.style.height="auto",t.style.minHeight="auto",t.style.maxHeight="auto",t.innerText=n.content,document.body.appendChild(t),t},z=(e,t)=>{var r,a;const{content:i,position:y,dots:m}=n,d=i.length,g=0+d>>1,k=v.action?(a=(r=E.value)==null?void 0:r.outerHTML)!=null?a:"":n.expandText,V=()=>{const o=(c,l)=>{if(l-c<=1)return y==="end"?i.slice(0,c)+m:m+i.slice(l,d);const s=Math.round((c+l)/2);return y==="end"?e.innerText=i.slice(0,s)+m:e.innerText=m+i.slice(s,d),e.innerHTML+=k,e.offsetHeight>t?y==="end"?o(c,s):o(s,l):y==="end"?o(s,l):o(c,s)};return o(0,d)},C=(o,c)=>{if(o[1]-o[0]<=1&&c[1]-c[0]<=1)return i.slice(0,o[0])+m+i.slice(c[1],d);const l=Math.floor((o[0]+o[1])/2),s=Math.ceil((c[0]+c[1])/2);return e.innerText=n.content.slice(0,l)+n.dots+n.content.slice(s,d),e.innerHTML+=k,e.offsetHeight>=t?C([o[0],l],[s,c[1]]):C([l,o[1]],[c[0],s])};return n.position==="middle"?C([0,g],[g,d]):V()},p=()=>{const e=_();if(!e){w=!0;return}const{paddingBottom:t,paddingTop:r,lineHeight:a}=e.style,i=Math.ceil((Number(n.rows)+.5)*H(a)+H(r)+H(t));i<e.offsetHeight?(M.value=!0,h.value=z(e,i)):(M.value=!1,h.value=n.content),document.body.removeChild(e)},N=(e=!u.value)=>{u.value=e},I=e=>{N(),L("clickAction",e)},R=()=>{const e=v.action?v.action({expanded:u.value}):S.value;return A("span",{ref:E,class:b("action"),onClick:I},[e])};return q(()=>{p(),v.action&&F(p)}),G(()=>{w&&(w=!1,p())}),J([Q,()=>[n.content,n.rows,n.position]],p),B({toggle:N}),()=>A("div",{ref:T,class:b()},[u.value?n.content:h.value,M.value?R():null])}});const ee=O(Y);export{ee as T};
